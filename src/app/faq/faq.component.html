<!--
/*********************************************************
 * src/app/faq/faq.component.html
 *********************************************************
-->
<div class="faq-container">

  <div class="faq-search">
    <label class="visually-hidden" for="faqSearchInput">
      Search FAQs
    </label>

    <!-- 
      This .search-wrapper has a fixed width (e.g. 300px),
      and both the input and suggestions will match that width.
    -->
    <div class="search-wrapper">
      <input
        #faqSearchBox
        id="faqSearchInput"
        type="text"
        placeholder="Search FAQs..."
        [(ngModel)]="searchQuery"
        (focus)="searchFocused = true"
        (blur)="onSearchBlur()"
        (input)="onSearchInputChange()"
        (keydown)="onSearchKeyDown($event)"
        aria-autocomplete="list"
        aria-controls="faq-suggestions"
        [attr.aria-expanded]="showSuggestions"
        role="combobox"
      />

      <span
        class="clear-tooltip"
        *ngIf="searchQuery && searchFocused"
        (mousedown)="onClearMouseDown($event, faqSearchBox)"
        aria-label="Clear search"
      >
        Clear
      </span>
    </div>

    <ul
      class="suggestions-list"
      *ngIf="showSuggestions"
      role="listbox"
      id="faq-suggestions"
    >
      <li
        *ngFor="let suggestion of suggestions; let i = index"
        (click)="onSuggestionClick(suggestion)"
        [class.highlighted]="i === selectedSuggestionIndex"
        [attr.aria-selected]="i === selectedSuggestionIndex"
        role="option"
      >
        {{ suggestion }}
      </li>
    </ul>
  </div>

  <div class="faq-category-buttons">
    <button (click)="clearCategory()" [disabled]="!currentCategory">
      All
    </button>
    <button
      *ngFor="let cat of categories"
      (click)="pickCategory(cat)"
      [class.active]="cat === currentCategory"
    >
      <img
        class="category-icon"
        [src]="categoryLogos[cat] || 'assets/icons/default.png'"
        alt="{{ cat }} logo"
      />
      {{ cat }}
    </button>
  </div>

  <div class="faq-category-buttons" *ngIf="currentCategory && subCategories[currentCategory]">
    <button
      *ngFor="let subCat of subCategories[currentCategory]"
      (click)="pickSubCategory(subCat)"
      [class.active]="subCat === currentSubCategory"
    >
      {{ subCat }}
    </button>
  </div>

  <mat-accordion>
    <mat-expansion-panel *ngFor="let item of filteredFAQ">
      <mat-expansion-panel-header>
        <mat-panel-title class="faq-title">
          <img
            class="category-icon"
            [src]="categoryLogos[item.category] || 'assets/icons/default.png'"
            alt="{{ item.category }} logo"
          />
          {{ item.question }}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div [innerHTML]="item.safeAnswer"></div>
    </mat-expansion-panel>
  </mat-accordion>
</div>
