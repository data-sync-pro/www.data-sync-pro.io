<div class="faq-editor-container">
  <!-- Header Bar -->
  <div class="editor-header">
    <h1 class="editor-title">FAQ Editor</h1>
    
    <div class="editor-stats">
      <span class="stat-item">
        <strong>{{ faqList.length }}</strong> Total FAQs
      </span>
      <span class="stat-item edited">
        <strong>{{ getEditedCount() }}</strong> Edited
      </span>
      <span class="stat-item" *ngIf="state.lastSaved">
        Last saved: {{ formatDate(state.lastSaved) }}
      </span>
    </div>

    <div class="editor-actions">
      <button class="btn btn-secondary" (click)="state.showVersionHistory = true" 
              [disabled]="!state.selectedFAQ">
        Version History
      </button>
      <button class="btn btn-secondary" (click)="state.showImportDialog = true">
        Import
      </button>
      <button class="btn btn-primary" (click)="state.showExportDialog = true"
              [disabled]="getEditedCount() === 0">
        Export ({{ getEditedCount() }})
      </button>
      <button class="btn btn-danger" (click)="clearAllEdits()"
              [disabled]="getEditedCount() === 0">
        Clear All
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="editor-main">
    <!-- Left Sidebar - FAQ List -->
    <div class="faq-list-panel">
      <!-- Search and Filter -->
      <div class="list-controls">
        <input type="text" 
               class="search-input"
               placeholder="Search FAQs..."
               [(ngModel)]="searchQuery"
               (input)="filterFAQs()">
        
        <select class="category-filter"
                [(ngModel)]="selectedCategory"
                (change)="filterFAQs()">
          <option value="">All Categories</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <!-- FAQ List -->
      <div class="faq-list">
        <div class="faq-item"
             *ngFor="let faq of filteredFAQs"
             [class.selected]="state.selectedFAQ?.id === faq.id"
             [class.edited]="isEdited(faq)"
             (click)="selectFAQ(faq)">
          <div class="faq-item-header">
            <span class="faq-id">{{ faq.name }}</span>
            <span class="edit-indicator" *ngIf="isEdited(faq)">‚úèÔ∏è</span>
          </div>
          <div class="faq-question">{{ faq.question }}</div>
          <div class="faq-category">{{ faq.category }}</div>
        </div>
      </div>
    </div>

    <!-- Middle - Editor -->
    <div class="editor-panel" *ngIf="state.selectedFAQ">
      <div class="editor-toolbar">
        <h2>Edit FAQ</h2>
        <div class="toolbar-actions">
          <button class="btn btn-sm btn-success" 
                  (click)="saveFAQ()"
                  [disabled]="!state.hasChanges || state.isSaving"
                  title="Save changes (Ctrl+S)">
            <span *ngIf="state.isSaving" class="spinner"></span>
            {{ state.isSaving ? 'Saving...' : 'Save' }}
          </button>
          <button class="btn btn-sm btn-secondary" 
                  (click)="resetCurrentFAQ()"
                  [disabled]="!state.selectedFAQ"
                  title="Reset current FAQ to original content">
            Reset
          </button>
        </div>
      </div>

      <!-- FAQ Metadata -->
      <div class="faq-metadata">
        <div class="form-row">
          <div class="form-group question-field">
            <label>Question:</label>
            <input type="text" 
                   class="form-control"
                   [(ngModel)]="currentQuestion"
                   (input)="state.hasChanges = true">
          </div>
          
          <div class="form-group category-field">
            <label>Category:</label>
            <select class="form-control"
                    [(ngModel)]="currentCategory"
                    (change)="state.hasChanges = true">
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
          </div>
        </div>
      </div>

      <!-- HTML Editor Toolbar -->
      <div class="html-editor-toolbar" *ngIf="!state.isLoading && state.selectedFAQ">
          <div class="toolbar-group">
            <button class="btn btn-sm btn-secondary" 
                    (click)="formatHTML()"
                    title="Format HTML (Alt+Shift+F)"
                    [disabled]="!editorContent">
              <span class="btn-icon">üé®</span>
              Format
            </button>
          </div>
          
          <div class="toolbar-separator"></div>
          
          <div class="toolbar-group">
            <button class="btn btn-sm btn-secondary" 
                    (click)="performUndo()"
                    title="Undo (Ctrl+Z)"
                    [disabled]="!canUndo()">
              <span class="btn-icon">‚Ü∂</span>
              Undo
            </button>
            <button class="btn btn-sm btn-secondary" 
                    (click)="performRedo()"
                    title="Redo (Ctrl+Y)"
                    [disabled]="!canRedo()">
              <span class="btn-icon">‚Ü∑</span>
              Redo
            </button>
          </div>
          
          <div class="toolbar-separator"></div>
          
          <div class="toolbar-group">
            <button class="btn btn-sm btn-secondary" 
                    (click)="wrapSelectedText('<strong>', '</strong>')"
                    title="Bold (Ctrl+B)">
              <span class="btn-icon"><strong>B</strong></span>
            </button>
            <button class="btn btn-sm btn-secondary" 
                    (click)="wrapSelectedText('<em>', '</em>')"
                    title="Italic (Ctrl+I)">
              <span class="btn-icon"><em>I</em></span>
            </button>
            <button class="btn btn-sm btn-secondary" 
                    (click)="wrapSelectedText('<u>', '</u>')"
                    title="Underline (Ctrl+U)">
              <span class="btn-icon"><u>U</u></span>
            </button>
          </div>
          
          <div class="toolbar-separator"></div>
          
          <div class="toolbar-group">
            <button class="btn btn-sm btn-secondary" 
                    (click)="insertLink()"
                    title="Insert Link (Ctrl+K)">
              <span class="btn-icon">üîó</span>
              Link
            </button>
            <button class="btn btn-sm btn-secondary" 
                    (click)="wrapSelectedText('<code>', '</code>')"
                    title="Code">
              <span class="btn-icon">&lt;/&gt;</span>
              Code
            </button>
          </div>
          
          <div class="toolbar-separator"></div>
          
          <div class="toolbar-group">
            <button class="btn btn-sm btn-info" 
                    (click)="insertParagraph()"
                    title="New Paragraph">
              <span class="btn-icon">¬∂</span>
              P
            </button>
            <button class="btn btn-sm btn-info" 
                    (click)="insertHeading()"
                    title="Insert Heading">
              <span class="btn-icon">H</span>
              Heading
            </button>
          </div>
      </div>

      <!-- HTML Source Code Editor -->
      <div class="editor-content" *ngIf="state.selectedFAQ">
        <div class="loading-indicator" *ngIf="state.isLoading">
          <p>Loading content...</p>
        </div>
        
        <div 
          #htmlSourceEditor
          class="html-wysiwyg-editor" 
          [class.hidden]="state.isLoading"
          contenteditable="true"
          (input)="onEditorContentChange()"
          placeholder="Content will appear here..."
          spellcheck="false"></div>
      </div>
    </div>

    <!-- Right - Preview -->
    <div class="preview-panel" *ngIf="state.selectedFAQ">
      <h3>Preview</h3>
      <div class="preview-content" [innerHTML]="previewContent"></div>
    </div>
  </div>

  <!-- No Selection Message -->
  <div class="no-selection" *ngIf="!state.selectedFAQ">
    <p>Select a FAQ from the list to start editing</p>
  </div>

  <!-- Storage Stats -->
  <div class="storage-stats">
    <div class="storage-bar">
      <div class="storage-used" [style.width.%]="storageStats.percentage"></div>
    </div>
    <span class="storage-text">
      Storage: {{ formatBytes(storageStats.used) }} / {{ formatBytes(storageStats.available) }}
    </span>
  </div>
</div>

<!-- Version History Modal -->
<div class="modal" *ngIf="state.showVersionHistory" (click)="state.showVersionHistory = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Version History</h2>
    <div class="version-list">
      <div class="version-item" *ngFor="let version of versionHistory">
        <div class="version-info">
          <strong>Version {{ version.version }}</strong>
          <span>{{ version.timestamp | date:'medium' }}</span>
        </div>
        <button class="btn btn-sm btn-primary" (click)="restoreVersion(version)">
          Restore
        </button>
      </div>
    </div>
    <button class="btn btn-secondary" (click)="state.showVersionHistory = false">Close</button>
  </div>
</div>

<!-- Export Dialog -->
<div class="modal" *ngIf="state.showExportDialog" (click)="state.showExportDialog = false">
  <div class="modal-content export-modal" (click)="$event.stopPropagation()">
    <h2>Export FAQ Edits</h2>
    
    <!-- Export Progress -->
    <div *ngIf="state.isExporting" class="export-progress">
      <div class="progress-header">
        <h3>{{ state.exportProgress?.step || 'Preparing export...' }}</h3>
        <span class="progress-percentage">{{ state.exportProgress?.percentage || 0 }}%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="state.exportProgress?.percentage || 0"></div>
      </div>
      <div class="progress-details" *ngIf="state.exportProgress">
        {{ state.exportProgress.current }} / {{ state.exportProgress.total }} files processed
      </div>
    </div>
    
    <!-- Export Options -->
    <div class="export-options" *ngIf="!state.isExporting">
      <div class="export-option recommended">
        <h4>üì¶ ZIP Archive (Recommended)</h4>
        <p>Download all files in a single ZIP archive. Easiest to manage and deploy.</p>
        <button class="btn btn-primary" (click)="exportAll()">
          <span class="btn-icon">üì¶</span>
          Export as ZIP
        </button>
      </div>
      
      <div class="export-option">
        <h4>üìÑ Individual Files</h4>
        <p>Download FAQ JSON, HTML files, and instructions separately.</p>
        <button class="btn btn-secondary" (click)="exportSeparateFiles()">
          <span class="btn-icon">üìÑ</span>
          Export Separate Files
        </button>
      </div>
      
      <div class="export-option">
        <h4>üîó JSON Only</h4>
        <p>Download only the FAQ data in JSON format (for backup or analysis).</p>
        <button class="btn btn-secondary" (click)="exportJSON()">
          <span class="btn-icon">üîó</span>
          Export JSON Data
        </button>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="modal-actions">
      <button class="btn btn-secondary" 
              (click)="state.showExportDialog = false"
              [disabled]="state.isExporting">
        {{ state.isExporting ? 'Please wait...' : 'Cancel' }}
      </button>
    </div>
  </div>
</div>

<!-- Import Dialog -->
<div class="modal" *ngIf="state.showImportDialog" (click)="state.showImportDialog = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Import FAQ Data</h2>
    <p>Select a previously exported JSON file to import:</p>
    <input type="file" 
           #fileInput
           accept=".json"
           style="display: none"
           (change)="importFile($event)">
    <button class="btn btn-primary" (click)="triggerFileInput()">
      Choose File
    </button>
    <button class="btn btn-secondary" (click)="state.showImportDialog = false">Cancel</button>
  </div>
</div>