<div class="recipe-search-overlay" *ngIf="isOpen" (click)="close()">
  <div class="search-overlay-content" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="overlay-header">
      <h2>Search Recipes</h2>
      <button class="close-btn" mat-icon-button (click)="close()" aria-label="Close search">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Search Input -->
    <div class="overlay-search-wrapper">
      <mat-icon class="search-icon">search</mat-icon>
      <input
        #searchInput
        type="text"
        class="overlay-search-input"
        [(ngModel)]="searchQuery"
        (ngModelChange)="filterRecipes()"
        placeholder="Search recipes by title, description, or tags..."
        autocomplete="off"
      />
      <span class="shortcut-hint" (click)="close()">ESC</span>
    </div>

    <!-- Filters -->
    <div class="filters-section" *ngIf="!isLoading">
      <!-- Category Filter -->
      <div class="filter-group" *ngIf="categories.length > 0">
        <div class="filter-header">
          <label class="filter-label">Categories</label>
          <button 
            class="clear-filters-btn" 
            *ngIf="selectedCategory || selectedDifficulty"
            (click)="clearFilters()">
            Clear filters
          </button>
        </div>
        <div class="filter-chips">
          <span
            class="filter-chip"
            *ngFor="let category of categories"
            [class.active]="selectedCategory === category"
            (click)="selectCategory(category)"
          >
            {{ category }}
          </span>
        </div>
      </div>

      <!-- Difficulty Filter -->
      <div class="filter-group">
        <label class="filter-label">Difficulty</label>
        <div class="filter-chips">
          <span
            class="filter-chip"
            *ngFor="let difficulty of difficulties"
            [class.active]="selectedDifficulty === difficulty"
            (click)="selectDifficulty(difficulty)"
          >
            {{ difficulty | titlecase }}
          </span>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div class="results-section">
      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <mat-spinner diameter="24"></mat-spinner>
        <span>Loading recipes...</span>
      </div>

      <!-- Error State -->
      <div class="error-placeholder" *ngIf="loadError && !isLoading">
        <mat-icon>error_outline</mat-icon>
        <p>Error loading recipes. Please try again.</p>
      </div>

      <!-- Results List -->
      <div class="results-list" *ngIf="!isLoading && !loadError && filteredRecipes.length > 0">
        <a
          class="result-item"
          *ngFor="let recipe of filteredRecipes"
          (click)="onSelectRecipe(recipe)"
          role="button"
          tabindex="0"
          (keydown.enter)="onSelectRecipe(recipe)"
        >
          <div class="result-content">
            <mat-icon>menu_book</mat-icon>
            <div class="result-text">
              <div class="result-title">{{ recipe.title }}</div>
              <div class="result-description">{{ recipe.description }}</div>
            </div>
          </div>
          <div class="result-meta">
            <span class="category-tag">{{ recipe.category }}</span>
            <span 
              class="difficulty-badge" 
              [ngClass]="getDifficultyClass(recipe.difficulty)"
            >
              <mat-icon>{{ getDifficultyIcon(recipe.difficulty) }}</mat-icon>
              {{ recipe.difficulty | titlecase }}
            </span>
          </div>
        </a>
      </div>

      <!-- No Results -->
      <div class="no-results" *ngIf="!isLoading && !loadError && filteredRecipes.length === 0">
        <mat-icon>search_off</mat-icon>
        <h3>No recipes found</h3>
        <p *ngIf="searchQuery">
          No recipes match "<strong>{{ searchQuery }}</strong>"
        </p>
        <p *ngIf="!searchQuery && (selectedCategory || selectedDifficulty)">
          No recipes match the selected filters
        </p>
        <p *ngIf="!searchQuery && !selectedCategory && !selectedDifficulty">
          Start typing to search for recipes
        </p>
      </div>
    </div>
  </div>
</div>